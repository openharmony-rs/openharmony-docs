# 划词服务概述（仅对系统应用开放）

<!--Kit: Basic Services Kit-->
<!--Subsystem: SelectionInput-->
<!--Owner: @no86-->
<!--Designer: @mmwwbb-->
<!--Tester: @dong-dongzhen-->
<!--Adviser: @fang-jinxu-->

从API version 20开始，新增划词服务模块，该模块具有跨应用文本处理及系统管理划词应用的能力。

该模块主要用于文本翻译、内容摘要、术语解释等场景。例如用户选中外文新闻中的单词时，可显示翻译结果；在阅读类应用中，可通过选中内容快速生成内容摘要；在学习类应用中，可识别用户选中的专业术语，提供即时解释卡片等。

## 框架原理

划词服务主要依托多模和剪贴板等领域，对外提供全局划词功能。该服务的核心业务流程主要分为以下几个步骤：
- 步骤一：划词服务可以根据系统设置中的开关按需启停。在启动时，会拉起用户选择的划词应用（未选择时，默认拉起最早安装的划词应用）。对应下图序号①②。
- 步骤二：在运行时，会监听多模事件以识别用户划词操作。在识别到用户想要触发划词后，会向剪贴板传递划词标记并注册回调函数。同时，会通过多模向被划词应用注入模拟的CTRL+C操作。对应下图序号③④⑤⑥。
- 步骤三：被划词应用在收到CTRL+C后，会触发复制操作，将当前用户选中的内容写入剪贴板。剪贴板在收到数据后，会回传文本内容给划词服务。最终，划词服务将内容传递给划词应用，由划词应用进行相应业务逻辑的处理，弹出划词窗口。对应下图序号⑦⑧⑨。

![划词服务框架原理图](figures/selection-service-schematic.png)

## 能力范围

- 划词方式：

  支持鼠标左键按下滑动、左键双击、左键三击三种划词方式。

- 触发方式：

  支持选中文本后直接触发弹窗、按下ctrl后触发弹窗两种方式，可在设置——>系统——>智慧划词界面切换。

- 弹窗管理：

  支持创建和管理菜单窗口与主窗口，提供窗口创建、移动、隐藏、销毁等接口，并支持自定义窗口内容。

- 应用管理：

  支持多个应用接入划词服务，但同一时间只可运行一个划词应用，可以在设置——>系统——>智慧划词界面切换划词应用。

## 约束限制

- 支持外接键盘和鼠标的2in1设备。

- 支持获取文本类型的划词内容，最大长度限制为6000个字节。

- 支持在扩展屏上使用，不支持跨设备使用。

- 当前接口为系统接口，计划于API version 22开放为公共接口。
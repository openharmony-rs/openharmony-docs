# native_avcodec_audioencoder.h

<!--Kit: AVCodec Kit-->
<!--Subsystem: Multimedia-->
<!--Owner: @mr-chencxy-->
<!--Designer: @dpy2650--->
<!--Tester: @baotianhao-->
<!--Adviser: @w_Machine_cc-->

## Overview

The file declares the native APIs used for audio encoding.

**File to include**: <multimedia/player_framework/native_avcodec_audioencoder.h>

**Library**: libnative_media_aenc.so

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 9

**Deprecated from**: 11

**Development suggestions**: All APIs of the current module have been deprecated. You can use [native_avcodec_audiocodec.h](capi-native-avcodec-audiocodec-h.md) instead. For details about the API mappings before and after the deprecation, see the API reference.

**Related module**: [AudioEncoder](capi-audioencoder.md)

## Summary

### Functions

| Name| Description|
| -- | -- |
| [OH_AVCodec *OH_AudioEncoder_CreateByMime(const char *mime)](#oh_audioencoder_createbymime) | Creates an audio encoder instance based on a MIME type. This function is recommended in most cases. (It is deprecated from API version 11.)|
| [OH_AVCodec *OH_AudioEncoder_CreateByName(const char *name)](#oh_audioencoder_createbyname) | Creates an audio encoder instance based on an encoder name. To use this function, you must know the exact name of the encoder. (It is deprecated from API version 11.)|
| [OH_AVErrCode OH_AudioEncoder_Destroy(OH_AVCodec *codec)](#oh_audioencoder_destroy) | Clears the internal resources of an audio encoder and destroys the encoder instance. (It is deprecated from API version 11.)|
| [OH_AVErrCode OH_AudioEncoder_SetCallback(OH_AVCodec *codec, OH_AVCodecAsyncCallback callback, void *userData)](#oh_audioencoder_setcallback) | Sets an asynchronous callback so that your application can respond to events generated by an audio encoder. This function must be called prior to **Prepare**. (It is deprecated from API version 11.)|
| [OH_AVErrCode OH_AudioEncoder_Configure(OH_AVCodec *codec, OH_AVFormat *format)](#oh_audioencoder_configure) | Configures an audio encoder. Typically, you need to configure the description information about the audio track to be encoded. This function must be called prior to **Prepare**. (It is deprecated from API version 11.)|
| [OH_AVErrCode OH_AudioEncoder_Prepare(OH_AVCodec *codec)](#oh_audioencoder_prepare) | Prepares internal resources for an audio encoder. This function must be called after **Configure**. (It is deprecated from API version 11.)|
| [OH_AVErrCode OH_AudioEncoder_Start(OH_AVCodec *codec)](#oh_audioencoder_start) | Starts an audio encoder after it is prepared successfully. After being started, the encoder starts to report the **OH_AVCodecOnNeedInputData** event. (It is deprecated from API version 11.)|
| [OH_AVErrCode OH_AudioEncoder_Stop(OH_AVCodec *codec)](#oh_audioencoder_stop) | Stops an audio encoder. After the encoder is stopped, you can call **Start** to start it again. (It is deprecated from API version 11.)|
| [OH_AVErrCode OH_AudioEncoder_Flush(OH_AVCodec *codec)](#oh_audioencoder_flush) | Clears the input and output data in the internal buffer of an audio encoder.<br>This function invalidates the indexes of all buffers previously reported through the asynchronous callback. Therefore, before calling this function, ensure that the buffers with the specified indexes are no longer required. (It is deprecated from API version 11.)|
| [OH_AVErrCode OH_AudioEncoder_Reset(OH_AVCodec *codec)](#oh_audioencoder_reset) | Resets an audio encoder. To continue encoding, you must call **Configure** to configure the encoder again. (It is deprecated from API version 11.)|
| [OH_AVFormat *OH_AudioEncoder_GetOutputDescription(OH_AVCodec *codec)](#oh_audioencoder_getoutputdescription) | Obtains the description information about the output data of an audio encoder. The caller must manually release the OH_AVFormat instance in the return value. (It is deprecated from API version 11.)|
| [OH_AVErrCode OH_AudioEncoder_SetParameter(OH_AVCodec *codec, OH_AVFormat *format)](#oh_audioencoder_setparameter) | Sets dynamic parameters for an audio encoder.<br>This function can be called only after the encoder is started. Incorrect parameter settings may cause encoding failure. (It is deprecated from API version 11.)|
| [OH_AVErrCode OH_AudioEncoder_PushInputData(OH_AVCodec *codec, uint32_t index, OH_AVCodecBufferAttr attr)](#oh_audioencoder_pushinputdata) | Notifies the audio encoder that the input data has been written to the buffer identified by **index**.<br>The [OH_AVCodecOnNeedInputData](capi-native-avcodec-base-h.md#oh_avcodeconneedinputdata) callback reports the available input buffer and the index. After being pushed to the encoder, a buffer is not accessible until the buffer with the same index is reported again through the [OH_AVCodecOnNeedInputData](capi-native-avcodec-base-h.md#oh_avcodeconneedinputdata) callback.<br>In addition, some encoders require the input of specific data to initialize the encoding process. (It is deprecated from API version 11.)|
| [OH_AVErrCode OH_AudioEncoder_FreeOutputData(OH_AVCodec *codec, uint32_t index)](#oh_audioencoder_freeoutputdata) | Frees an output buffer of an audio encoder. (It is deprecated from API version 11.)|
| [OH_AVErrCode OH_AudioEncoder_IsValid(OH_AVCodec *codec, bool *isValid)](#oh_audioencoder_isvalid) | Checks whether an audio encoder instance is valid. This function is used to check the encoder validity when the background recovers from a fault or an application is switched from the background. (It is deprecated from API version 11.)|

## Function Description

### OH_AudioEncoder_CreateByMime()

```
OH_AVCodec *OH_AudioEncoder_CreateByMime(const char *mime)
```

**Description**

Creates an audio encoder instance based on a MIME type. This function is recommended in most cases.

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 9

**Deprecated from**: 11

**Substitute**: [OH_AudioCodec_CreateByMime](capi-native-avcodec-audiocodec-h.md#oh_audiocodec_createbymime)

**Parameters**

| Name| Description|
| -- | -- |
| const char *mime | Pointer to a string that describes the MIME type. For details, see [AVCODEC_MIMETYPE](capi-native-avcodec-base-h.md#variables).|

**Returns**

| Type| Description|
| -- | -- |
| [OH_AVCodec *](capi-codecbase-oh-avcodec.md) | Pointer to an OH_AVCodec instance.|

### OH_AudioEncoder_CreateByName()

```
OH_AVCodec *OH_AudioEncoder_CreateByName(const char *name)
```

**Description**

Creates an audio encoder instance based on an encoder name. To use this function, you must know the exact name of the encoder.

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 9

**Deprecated from**: 11

**Substitute**: [OH_AudioCodec_CreateByName](capi-native-avcodec-audiocodec-h.md#oh_audiocodec_createbyname)


**Parameters**

| Name| Description|
| -- | -- |
| const char *name | Pointer to an audio encoder name.|

**Returns**

| Type| Description|
| -- | -- |
| [OH_AVCodec *](capi-codecbase-oh-avcodec.md) | Pointer to an OH_AVCodec instance.|

### OH_AudioEncoder_Destroy()

```
OH_AVErrCode OH_AudioEncoder_Destroy(OH_AVCodec *codec)
```

**Description**

Clears the internal resources of an audio encoder and destroys the encoder instance.

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 9

**Deprecated from**: 11

**Substitute**: [OH_AudioCodec_Destroy](capi-native-avcodec-audiocodec-h.md#oh_audiocodec_destroy)

**Parameters**

| Name| Description|
| -- | -- |
| [OH_AVCodec](capi-codecbase-oh-avcodec.md) *codec | Pointer to an OH_AVCodec instance.|

**Returns**

| Type| Description|
| -- | -- |
| [OH_AVErrCode](capi-native-averrors-h.md#oh_averrcode) | **AV_ERR_OK** if the operation is successful; a specific error code otherwise.|

### OH_AudioEncoder_SetCallback()

```
OH_AVErrCode OH_AudioEncoder_SetCallback(OH_AVCodec *codec, OH_AVCodecAsyncCallback callback, void *userData)
```

**Description**

Sets an asynchronous callback so that your application can respond to events generated by an audio encoder. This function must be called prior to **Prepare**.

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 9

**Deprecated from**: 11

**Substitute**: [OH_AudioCodec_RegisterCallback](capi-native-avcodec-audiocodec-h.md#oh_audiocodec_registercallback)

**Parameters**

| Name| Description|
| -- | -- |
| [OH_AVCodec](capi-codecbase-oh-avcodec.md) *codec | Pointer to an OH_AVCodec instance.|
| [OH_AVCodecAsyncCallback](capi-codecbase-oh-avcodecasynccallback.md) callback | Callback function.|
| void *userData | User-specific data.|

**Returns**

| Type| Description|
| -- | -- |
| [OH_AVErrCode](capi-native-averrors-h.md#oh_averrcode) | **AV_ERR_OK** if the operation is successful; a specific error code otherwise.|

### OH_AudioEncoder_Configure()

```
OH_AVErrCode OH_AudioEncoder_Configure(OH_AVCodec *codec, OH_AVFormat *format)
```

**Description**

Configures an audio encoder. Typically, you need to configure the description information about the audio track to be encoded. This function must be called prior to **Prepare**.

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 9

**Deprecated from**: 11

**Substitute**: [OH_AudioCodec_Configure](capi-native-avcodec-audiocodec-h.md#oh_audiocodec_configure)

**Parameters**

| Name| Description|
| -- | -- |
| [OH_AVCodec](capi-codecbase-oh-avcodec.md) *codec | Pointer to an OH_AVCodec instance.|
| [OH_AVFormat](capi-core-oh-avformat.md) *format | Pointer to an OH_AVFormat instance, which provides the description information about the audio track to be encoded.|

**Returns**

| Type| Description|
| -- | -- |
| [OH_AVErrCode](capi-native-averrors-h.md#oh_averrcode) | **AV_ERR_OK** if the operation is successful; a specific error code otherwise.|

### OH_AudioEncoder_Prepare()

```
OH_AVErrCode OH_AudioEncoder_Prepare(OH_AVCodec *codec)
```

**Description**

Prepares internal resources for an audio encoder. This function must be called after **Configure**.

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 9

**Deprecated from**: 11

**Substitute**: [OH_AudioCodec_Prepare](capi-native-avcodec-audiocodec-h.md#oh_audiocodec_prepare)

**Parameters**

| Name| Description|
| -- | -- |
| [OH_AVCodec](capi-codecbase-oh-avcodec.md) *codec | Pointer to an OH_AVCodec instance.|

**Returns**

| Type| Description|
| -- | -- |
| [OH_AVErrCode](capi-native-averrors-h.md#oh_averrcode) | **AV_ERR_OK** if the operation is successful; a specific error code otherwise.|

### OH_AudioEncoder_Start()

```
OH_AVErrCode OH_AudioEncoder_Start(OH_AVCodec *codec)
```

**Description**

Starts an audio encoder after it is prepared successfully. After being started, the encoder starts to report the **OH_AVCodecOnNeedInputData** event.

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 9

**Deprecated from**: 11

**Substitute**: [OH_AudioCodec_Start](capi-native-avcodec-audiocodec-h.md#oh_audiocodec_start)

**Parameters**

| Name| Description|
| -- | -- |
| [OH_AVCodec](capi-codecbase-oh-avcodec.md) *codec | Pointer to an OH_AVCodec instance.|

**Returns**

| Type| Description|
| -- | -- |
| [OH_AVErrCode](capi-native-averrors-h.md#oh_averrcode) | **AV_ERR_OK** if the operation is successful; a specific error code otherwise.|

### OH_AudioEncoder_Stop()

```
OH_AVErrCode OH_AudioEncoder_Stop(OH_AVCodec *codec)
```

**Description**

Stops an audio encoder. After the encoder is stopped, you can call **Start** to start it again.

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 9

**Deprecated from**: 11

**Substitute**: [OH_AudioCodec_Stop](capi-native-avcodec-audiocodec-h.md#oh_audiocodec_stop)

**Parameters**

| Name| Description|
| -- | -- |
| [OH_AVCodec](capi-codecbase-oh-avcodec.md) *codec | Pointer to an OH_AVCodec instance.|

**Returns**

| Type| Description|
| -- | -- |
| [OH_AVErrCode](capi-native-averrors-h.md#oh_averrcode) | **AV_ERR_OK** if the operation is successful; a specific error code otherwise.|

### OH_AudioEncoder_Flush()

```
OH_AVErrCode OH_AudioEncoder_Flush(OH_AVCodec *codec)
```

**Description**

Clears the input and output data in the internal buffer of an audio encoder.

This function invalidates the indexes of all buffers previously reported through the asynchronous callback. Therefore, before calling this function, ensure that the buffers with the specified indexes are no longer required.

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 9

**Deprecated from**: 11

**Substitute**: [OH_AudioCodec_Flush](capi-native-avcodec-audiocodec-h.md#oh_audiocodec_flush)

**Parameters**

| Name| Description|
| -- | -- |
| [OH_AVCodec](capi-codecbase-oh-avcodec.md) *codec | Pointer to an OH_AVCodec instance.|

**Returns**

| Type| Description|
| -- | -- |
| [OH_AVErrCode](capi-native-averrors-h.md#oh_averrcode) | **AV_ERR_OK** if the operation is successful; a specific error code otherwise.|

### OH_AudioEncoder_Reset()

```
OH_AVErrCode OH_AudioEncoder_Reset(OH_AVCodec *codec)
```

**Description**

Resets an audio encoder. To continue encoding, you must call **Configure** to configure the encoder again.

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 9

**Deprecated from**: 11

**Substitute**: [OH_AudioCodec_Reset](capi-native-avcodec-audiocodec-h.md#oh_audiocodec_reset)

**Parameters**

| Name| Description|
| -- | -- |
| [OH_AVCodec](capi-codecbase-oh-avcodec.md) *codec | Pointer to an OH_AVCodec instance.|

**Returns**

| Type| Description|
| -- | -- |
| [OH_AVErrCode](capi-native-averrors-h.md#oh_averrcode) | **AV_ERR_OK** if the operation is successful; a specific error code otherwise.|

### OH_AudioEncoder_GetOutputDescription()

```
OH_AVFormat *OH_AudioEncoder_GetOutputDescription(OH_AVCodec *codec)
```

**Description**

Obtains the description information about the output data of an audio encoder. The caller must manually release the OH_AVFormat instance in the return value.

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 9

**Deprecated from**: 11

**Substitute**: [OH_AudioCodec_GetOutputDescription](capi-native-avcodec-audiocodec-h.md#oh_audiocodec_getoutputdescription)

**Parameters**

| Name| Description|
| -- | -- |
| [OH_AVCodec](capi-codecbase-oh-avcodec.md) *codec | Pointer to an OH_AVCodec instance.|

**Returns**

| Type| Description|
| -- | -- |
| [OH_AVFormat](capi-core-oh-avformat.md) * | Handle to an OH_AVFormat instance. The lifecycle of this instance is refreshed when **GetOutputDescription** is called again and destroyed when the OH_AVCodec instance is destroyed.|

### OH_AudioEncoder_SetParameter()

```
OH_AVErrCode OH_AudioEncoder_SetParameter(OH_AVCodec *codec, OH_AVFormat *format)
```

**Description**

Sets dynamic parameters for an audio encoder.

This function can be called only after the encoder is started. Incorrect parameter settings may cause encoding failure.

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 9

**Deprecated from**: 11

**Substitute**: [OH_AudioCodec_SetParameter](capi-native-avcodec-audiocodec-h.md#oh_audiocodec_setparameter)

**Parameters**

| Name| Description|
| -- | -- |
| [OH_AVCodec](capi-codecbase-oh-avcodec.md) *codec | Pointer to an OH_AVCodec instance.|
| [OH_AVFormat](capi-core-oh-avformat.md) *format | Handle to an OH_AVFormat instance.|

**Returns**

| Type| Description|
| -- | -- |
| [OH_AVErrCode](capi-native-averrors-h.md#oh_averrcode) | **AV_ERR_OK** if the operation is successful; a specific error code otherwise.|

### OH_AudioEncoder_PushInputData()

```
OH_AVErrCode OH_AudioEncoder_PushInputData(OH_AVCodec *codec, uint32_t index, OH_AVCodecBufferAttr attr)
```

**Description**

Notifies the audio encoder that the input data has been written to the buffer identified by **index**.

The [OH_AVCodecOnNeedInputData](capi-native-avcodec-base-h.md#oh_avcodeconneedinputdata) callback reports the available input buffer and the index. After being pushed to the encoder, a buffer is not accessible until the buffer with the same index is reported again through the [OH_AVCodecOnNeedInputData](capi-native-avcodec-base-h.md#oh_avcodeconneedinputdata) callback.

In addition, some encoders require the input of specific data to initialize the encoding process.

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 9

**Deprecated from**: 11

**Substitute**: [OH_AudioCodec_PushInputBuffer](capi-native-avcodec-audiocodec-h.md#oh_audiocodec_pushinputbuffer)

**Parameters**

| Name| Description|
| -- | -- |
| [OH_AVCodec](capi-codecbase-oh-avcodec.md) *codec | Pointer to an OH_AVCodec instance.|
| uint32_t index | Index of the input buffer.|
| [OH_AVCodecBufferAttr](capi-core-oh-avcodecbufferattr.md) attr | Description information about the data in the buffer.|

**Returns**

| Type| Description|
| -- | -- |
| [OH_AVErrCode](capi-native-averrors-h.md#oh_averrcode) | **AV_ERR_OK** if the operation is successful; a specific error code otherwise.|

### OH_AudioEncoder_FreeOutputData()

```
OH_AVErrCode OH_AudioEncoder_FreeOutputData(OH_AVCodec *codec, uint32_t index)
```

**Description**

Frees an output buffer of an audio encoder.

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 9

**Deprecated from**: 11

**Substitute**: [OH_AudioCodec_FreeOutputBuffer](capi-native-avcodec-audiocodec-h.md#oh_audiocodec_freeoutputbuffer)

**Parameters**

| Name| Description|
| -- | -- |
| [OH_AVCodec](capi-codecbase-oh-avcodec.md) *codec | Pointer to an OH_AVCodec instance.|
| uint32_t index | Index of the output buffer.|

**Returns**

| Type| Description|
| -- | -- |
| [OH_AVErrCode](capi-native-averrors-h.md#oh_averrcode) | **AV_ERR_OK** if the operation is successful; a specific error code otherwise.|

### OH_AudioEncoder_IsValid()

```
OH_AVErrCode OH_AudioEncoder_IsValid(OH_AVCodec *codec, bool *isValid)
```

**Description**

Checks whether an audio encoder instance is valid. This function is used to check the encoder validity when the background recovers from a fault or an application is switched from the background.

**System capability**: SystemCapability.Multimedia.Media.AudioEncoder

**Since**: 10

**Deprecated from**: 11

**Substitute**: [OH_AudioCodec_IsValid](capi-native-avcodec-audiocodec-h.md#oh_audiocodec_isvalid)

**Parameters**

| Name| Description|
| -- | -- |
| [OH_AVCodec](capi-codecbase-oh-avcodec.md) *codec | Pointer to an OH_AVCodec instance.|
| bool *isValid | Pointer of the Boolean type. The value **true** means that the encoder instance is valid and **false** means the opposite.|

**Returns**

| Type| Description|
| -- | -- |
| [OH_AVErrCode](capi-native-averrors-h.md#oh_averrcode) | **AV_ERR_OK** if the operation is successful; a specific error code otherwise.|
